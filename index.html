<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MathBoard ‚Äî –ë–∞—Å—Ç—ã –±–µ—Ç</title>
  <style>
    :root{
      --bg:#070A12; --bg2:#0B1020;
      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --text:#EAF0FF; --muted: rgba(234,240,255,.72);
      --radius:18px; --shadow: 0 18px 60px rgba(0,0,0,.38);
      --accent1:#22d3ee; --accent2:#7c3aed; --accent3:#f472b6;
      --slide-w:320px;
    }
    body[data-theme="day"]{
      --bg:#F6FBFF; --bg2:#FFF6FB;
      --card: rgba(255,255,255,.94);
      --border: rgba(17,24,39,.08);
      --text:#07101f; --muted: rgba(11,18,32,.64);
      --shadow: 0 18px 60px rgba(37,99,235,.08);
    }

    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 8% 12%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(800px 500px at 86% 20%, rgba(124,58,237,.10), transparent 50%),
        linear-gradient(180deg,var(--bg),var(--bg2));
      transition: background .22s ease, color .22s ease;
      -webkit-font-smoothing:antialiased;
    }

    .container{max-width:1280px;margin:18px auto;padding:18px;position:relative;z-index:2;}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:12px;background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow);backdrop-filter:blur(8px);}
    .brand{display:flex;gap:12px;align-items:center;}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:grid;place-items:center;font-weight:900;color:#06101f;}
    .brand h1{margin:0;font-size:18px;}
    .brand p{margin:2px 0 0;color:var(--muted);font-size:13px;}
    .top-actions{display:flex;gap:10px;align-items:center;}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);cursor:pointer;font-weight:800;}
    .btn.primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));border:0;color:#07101f;}

    .hero{margin-top:16px;padding:20px;border-radius:14px;background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow);text-align:center;position:relative;overflow:hidden;}
    .wideTitle{font-size:30px;font-weight:900;background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));-webkit-background-clip:text;background-clip:text;color:transparent;margin:0;}
    .wideSubtitle{margin-top:8px;color:var(--muted);max-width:980px;margin-left:auto;margin-right:auto;font-size:14px;}

    /* QUICK NAV (carousel) */
    .quickNavWrap{margin-top:18px;display:flex;gap:12px;align-items:center;justify-content:center;}
    .navBtn{background:rgba(255,255,255,0.04);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;cursor:pointer;display:inline-grid;place-items:center;width:44px;height:44px;}
    .slideViewport{overflow:hidden;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;width:calc(100% - 120px);max-width:980px;}
    .slideRow{display:flex;gap:12px;padding:12px;transition:transform 320ms cubic-bezier(.2,.8,.2,1);will-change:transform;}
    .slide{flex:0 0 var(--slide-w);min-width:var(--slide-w);border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid var(--border);padding:14px;display:flex;gap:12px;align-items:flex-start;box-shadow:0 8px 26px rgba(0,0,0,.12);text-decoration:none;color:inherit;}
    .slide .ico{width:56px;height:56px;border-radius:10px;display:grid;place-items:center;font-weight:900;color:#06101f;background:linear-gradient(135deg,var(--accent1),var(--accent2));flex-shrink:0;}
    .slide .txt{display:flex;flex-direction:column;gap:6px;}
    .slide .t{font-size:15px;font-weight:900;line-height:1.05;word-break:break-word;}
    .slide .d{font-size:13px;color:var(--muted);line-height:1.25;white-space:normal;}
    @media(max-width:880px){:root{--slide-w:260px;} .slideViewport{width:calc(100% - 100px);} }
    @media(max-width:600px){:root{--slide-w:240px;} .slideViewport{width:calc(100% - 80px);} }

    /* Layout: left formulas, center board, right formulas */
    .layout{display:grid;grid-template-columns:260px 1fr 260px;gap:14px;margin-top:18px;align-items:start;position:relative;z-index:3;}
    @media(max-width:1100px){.layout{grid-template-columns:1fr;}}

    .panel{padding:14px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid var(--border);box-shadow:var(--shadow);min-height:160px;}
    .panel h3{margin:0 0 10px;}
    .form-list{display:flex;flex-direction:column;gap:10px;max-height:520px;overflow:auto;padding-right:6px;}
    .form-item{display:flex;flex-direction:column;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);}
    .form-item .title{font-weight:900;font-size:13px;margin-bottom:6px;}
    .form-item .expr{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-weight:800;font-size:15px;color:var(--accent1);}
    .form-item .desc{font-size:12px;color:var(--muted);margin-top:6px;}

    .boardWrap{padding:14px;border-radius:12px;background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow);}
    .boardHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
    .tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
    .tool{padding:8px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text);font-size:13px;}
    canvas{width:100%;height:420px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);}

    /* Games row under board */
    .gamesRow{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:14px;}
    .gcard{padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border:1px solid var(--border);display:flex;flex-direction:column;gap:10px;min-height:110px;}
    .gcard .head{display:flex;gap:10px;align-items:center;}
    .gcard .ico{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;font-weight:900;color:#06101f;background:linear-gradient(135deg,var(--accent1),var(--accent2));}

    /* Decorative background for formulas/games: soft shapes */
    .bg-decor{
      position:fixed;inset:0;z-index:1;pointer-events:none;opacity:0.28;
      background-image:
        radial-gradient(600px 250px at 6% 15%, rgba(34,211,238,.06), transparent 40%),
        radial-gradient(450px 220px at 92% 20%, rgba(124,58,237,.06), transparent 40%),
        radial-gradient(300px 160px at 50% 85%, rgba(244,114,182,.04), transparent 40%);
      mix-blend-mode:screen;
    }

    /* scroll styling */
    .form-list::-webkit-scrollbar{width:8px;}
    .form-list::-webkit-scrollbar-thumb{background:rgba(255,255,255,.06);border-radius:6px;}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px;}
  </style>
</head>
<body data-theme="night">
  <div class="bg-decor" aria-hidden="true"></div>

  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">‚àë</div>
        <div>
          <h1>MathBoard</h1>
          <p>8‚Äì9 —Å—ã–Ω—ã–ø ‚Ä¢ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä ‚Ä¢ –æ–Ω–ª–∞–π–Ω —Ç–∞“õ—Ç–∞ ‚Ä¢ –æ–π—ã–Ω–¥–∞—Ä</p>
        </div>
      </div>

      <div class="top-actions">
        <button id="themeBtn" class="btn">üåô –¢“Ø–Ω</button>
        <a class="btn" href="olympiad.html">–û–ª–∏–º–ø–∏–∞–¥–∞</a>
      </div>
    </header>

    <section class="hero">
      <div>
        <div class="wideTitle">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ‚Äî –æ–π–ª–∞—É–¥—ã“£ —Ç—ñ–ª—ñ</div>
        <div class="wideSubtitle">–ú–∞“õ—Å–∞—Ç: –µ—Å–µ–ø—Ç—ñ —Ç“Ø—Å—ñ–Ω—ñ–ø, –¥”ô–ª–µ–ª–¥–µ—É –∂”ô–Ω–µ –±—ñ—Ä–Ω–µ—à–µ —Ç”ô—Å—ñ–ª–º–µ–Ω —à—ã“ì–∞—Ä—É –¥–∞“ì–¥—ã–ª–∞—Ä—ã–Ω –¥–∞–º—ã—Ç—É.</div>
      </div>

      <!-- QUICK NAV: arrows + viewport -->
      <div class="quickNavWrap" style="margin-top:18px;">
        <button class="navBtn" id="prevBtn" aria-label="–ê–ª–¥—ã“£“ì—ã">&#8592;</button>

        <div class="slideViewport" id="viewport">
          <div class="slideRow" id="slideRow">
            <a class="slide" href="arithm_prog.html">
              <div class="ico" style="background:linear-gradient(135deg,#22d3ee,#60a5fa)">–ê–ü</div>
              <div class="txt"><div class="t">–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è</div><div class="d">a‚Çô = a‚ÇÅ + (n‚àí1)d ¬∑ S‚Çô = (n/2)(2a‚ÇÅ+(n‚àí1)d)</div></div>
            </a>

            <a class="slide" href="geom_prog.html">
              <div class="ico" style="background:linear-gradient(135deg,#a78bfa,#f472b6)">–ì–ü</div>
              <div class="txt"><div class="t">–ì–µ–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è</div><div class="d">b‚Çô = b‚ÇÅ¬∑q‚Åø‚Åª¬π ¬∑ S‚Çô = b‚ÇÅ*(q‚Åø‚àí1)/(q‚àí1)</div></div>
            </a>

            <a class="slide" href="geometry_plane.html">
              <div class="ico" style="background:linear-gradient(135deg,#34d399,#22d3ee)">‚ñ≥</div>
              <div class="txt"><div class="t">–ì–µ–æ–º–µ—Ç—Ä–∏—è (–ø–ª–∞–Ω–∏–º–µ—Ç—Ä–∏—è)</div><div class="d">S = ¬Ω a¬∑h ¬∑ –®–µ“£–±–µ—Ä: S=œÄr¬≤, C=2œÄr</div></div>
            </a>

            <a class="slide" href="combinatorics.html">
              <div class="ico" style="background:linear-gradient(135deg,#fbbf24,#fb7185)">C</div>
              <div class="txt"><div class="t">–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞</div><div class="d">C(n,k)=n!/(k!(n‚àík)!) ‚Äî —Ç–∞“£–¥–∞—É</div></div>
            </a>

            <a class="slide" href="trig.html">
              <div class="ico" style="background:linear-gradient(135deg,#60a5fa,#a78bfa)">sin</div>
              <div class="txt"><div class="t">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</div><div class="d">sin¬≤x+cos¬≤x=1 ¬∑ –≥—Ä–∞–¥—É—Å/—Ä–∞–¥–∏–∞–Ω —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É</div></div>
            </a>

            <a class="slide" href="functions.html">
              <div class="ico" style="background:linear-gradient(135deg,#34d399,#fbbf24)">f(x)</div>
              <div class="txt"><div class="t">–§—É–Ω–∫—Ü–∏—è–ª–∞—Ä</div><div class="d">y=kx+b, y=ax¬≤+bx+c, y=a/x ‚Äî –≥—Ä–∞—Ñ–∏–∫—Ç–µ—Ä</div></div>
            </a>

            <a class="slide" href="olympiad.html">
              <div class="ico" style="background:linear-gradient(135deg,#fb7185,#f472b6)">‚òÖ</div>
              <div class="txt"><div class="t">–û–ª–∏–º–ø–∏–∞–¥–∞ –µ—Å–µ–ø—Ç–µ—Ä—ñ</div><div class="d">20 –µ—Å–µ–ø ‚Äî –∫”©–ø —Ç”ô—Å—ñ–ª–¥—ñ —à–µ—à—É–ª–µ—Ä</div></div>
            </a>

            <a class="slide" href="math_literacy.html">
              <div class="ico" style="background:linear-gradient(135deg,#22d3ee,#34d399)">ML</div>
              <div class="txt"><div class="t">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ —Å–∞—É–∞—Ç—Ç—ã–ª—ã“õ</div><div class="d">10√ó4√ó10 —Ç–µ—Å—Ç –∂“Ø–π–µ—Å—ñ</div></div>
            </a>
          </div>
        </div>

        <button class="navBtn" id="nextBtn" aria-label="–ö–µ–ª–µ—Å—ñ">&#8594;</button>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px;">–°–ª–∞–π–¥—Ç–∞—Ä–¥—ã –∫”©—Ä—Å–µ—Ç–∫—ñ–º–µ–Ω –Ω–µ–º–µ—Å–µ —Å—ã—Ä“ì—ã—Ç—É –∞—Ä“õ—ã–ª—ã –∂—ã–ª–∂—ã—Ç—ã“£—ã–∑</div>
    </section>

    <!-- MAIN layout with left & right formulas and center board + games -->
    <section class="layout">
      <!-- LEFT formulas -->
      <aside class="panel" aria-label="–§–æ—Ä–º—É–ª–∞–ª–∞—Ä —Å–æ–ª –∂–∞“õ">
        <h3>–ù–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä ‚Äî 1</h3>
        <div class="form-list">
          <div class="form-item">
            <div class="title">–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è</div>
            <div class="expr">a‚Çô = a‚ÇÅ + (n ‚àí 1) d</div>
            <div class="desc">n-—à—ñ –º“Ø—à–µ</div>
          </div>
          <div class="form-item">
            <div class="title">AP “õ–æ—Å–ø–∞—Å—ã</div>
            <div class="expr">S‚Çô = (n/2)(2a‚ÇÅ + (n‚àí1)d)</div>
            <div class="desc">–ê–ª“ì–∞—à“õ—ã n –º“Ø—à–µ–Ω—ñ “õ–æ—Å—É</div>
          </div>
          <div class="form-item">
            <div class="title">–ì–µ–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è</div>
            <div class="expr">b‚Çô = b‚ÇÅ ¬∑ q‚Åø‚Åª¬π</div>
            <div class="desc">n-—à—ñ –º“Ø—à–µ</div>
          </div>
          <div class="form-item">
            <div class="title">GP “õ–æ—Å–ø–∞—Å—ã</div>
            <div class="expr">S‚Çô = b‚ÇÅ¬∑(q‚Åø ‚àí1)/(q‚àí1)</div>
            <div class="desc">q ‚â† 1</div>
          </div>
          <div class="form-item">
            <div class="title">–ö–≤–∞–¥—Ä–∞—Ç—Ç—ã“õ —Ñ—É–Ω–∫—Ü–∏—è</div>
            <div class="expr">y = ax¬≤ + bx + c</div>
            <div class="desc">–ü–∞—Ä–∞–±–æ–ª–∞</div>
          </div>
        </div>
      </aside>

      <!-- CENTER board -->
      <main class="boardWrap" aria-label="–¢–∞“õ—Ç–∞ –∂”ô–Ω–µ –æ–π—ã–Ω–¥–∞—Ä –æ—Ä—Ç–∞–ª—ã“ì—ã">
        <div class="boardHead">
          <div>
            <h3 style="margin:0">–û–Ω–ª–∞–π–Ω —Ç–∞“õ—Ç–∞</h3>
            <div style="color:var(--muted);font-size:13px;margin-top:6px;">“ö–∞–ª–∞–º, ”©—à—ñ—Ä–≥—ñ—à, —Å—ã–∑“ì—ã—à ‚Äî —Ç–∞“õ—Ç–∞–¥–∞ –∂–∞–∑—ã–ø, –≥—Ä–∞—Ñ–∏–∫ —Å—ã–∑—É“ì–∞ –±–æ–ª–∞–¥—ã.</div>
          </div>
          <div class="tools">
            <div class="tool">–†–µ–∂–∏–º:
              <select id="mode"><option value="pen">“ö–∞–ª–∞–º</option><option value="eraser">”®—à—ñ—Ä–≥—ñ—à</option><option value="line">–°—ã–∑“ì—ã—à</option></select>
            </div>
            <div class="tool">“ö–∞–ª—ã“£–¥—ã“õ: <input id="size" type="range" min="2" max="22" value="4"></div>
            <div class="tool">–¢“Ø—Å: <input id="color" type="color" value="#22d3ee"></div>
            <div class="tool"><button id="undoBtn">‚Ü∂ Undo</button></div>
            <div class="tool"><button id="clearBtn">üßΩ –¢–∞–∑–∞–ª–∞—É</button></div>
          </div>
        </div>

        <canvas id="canvas"></canvas>

        <!-- games restored under board -->
        <div class="gamesRow" aria-label="–û–π—ã–Ω–¥–∞—Ä">
          <div class="gcard">
            <div class="head"><div class="ico" style="background:linear-gradient(135deg,#22d3ee,#60a5fa)">–§</div>
              <div><b>Formula Sprint</b><div style="font-size:13px;color:var(--muted)">–§–æ—Ä–º—É–ª–∞–ª–∞—Ä–¥—ã –∂—ã–ª–¥–∞–º —Ç–∞–Ω—É</div></div>
            </div>
            <div style="margin-top:auto;display:flex;gap:8px;"><a class="btn primary" href="formula_sprint.html">–ë–∞—Å—Ç–∞—É</a><a class="btn" href="formula_sprint.html">–ê—à—É</a></div>
          </div>

          <div class="gcard">
            <div class="head"><div class="ico" style="background:linear-gradient(135deg,#60a5fa,#a78bfa)">–ú</div>
              <div><b>Match: –§–æ—Ä–º—É–ª–∞ ‚Üî –ê—Ç–∞—É—ã</b><div style="font-size:13px;color:var(--muted)">–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É</div></div>
            </div>
            <div style="margin-top:auto;display:flex;gap:8px;"><a class="btn primary" href="match_formula.html">–ë–∞—Å—Ç–∞—É</a><a class="btn" href="match_formula.html">–ê—à—É</a></div>
          </div>

          <div class="gcard">
            <div class="head"><div class="ico" style="background:linear-gradient(135deg,#fb7185,#f472b6)">Q</div>
              <div><b>AP/GP Quest</b><div style="font-size:13px;color:var(--muted)">–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è –µ—Å–µ–ø—Ç–µ—Ä</div></div>
            </div>
            <div style="margin-top:auto;display:flex;gap:8px;"><a class="btn primary" href="apgp_quest.html">–ë–∞—Å—Ç–∞—É</a><a class="btn" href="apgp_quest.html">–ê—à—É</a></div>
          </div>
        </div>
      </main>

      <!-- RIGHT formulas -->
      <aside class="panel" aria-label="–§–æ—Ä–º—É–ª–∞–ª–∞—Ä –æ“£ –∂–∞“õ">
        <h3>–ù–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä ‚Äî 2</h3>
        <div class="form-list">
          <div class="form-item">
            <div class="title">“Æ—à–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã</div>
            <div class="expr">S = ¬Ω ¬∑ a ¬∑ h</div>
            <div class="desc">“ö–∞–±—ã—Ä“ì–∞ –º–µ–Ω –±–∏—ñ–∫—Ç—ñ–∫—Ç–µ–Ω</div>
          </div>
          <div class="form-item">
            <div class="title">–®–µ“£–±–µ—Ä</div>
            <div class="expr">S = œÄ r¬≤ ¬∑ C = 2œÄ r</div>
            <div class="desc">r ‚Äî —Ä–∞–¥–∏—É—Å</div>
          </div>
          <div class="form-item">
            <div class="title">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ —Ç–æ—Ç–æ–∂–¥—ã</div>
            <div class="expr">sin¬≤x + cos¬≤x = 1</div>
            <div class="desc">–ë–∞—Ä–ª—ã“õ x “Ø—à—ñ–Ω</div>
          </div>
          <div class="form-item">
            <div class="title">–ö–æ–º–±–∏–Ω–∞—Ü–∏—è–ª–∞—Ä</div>
            <div class="expr">C(n,k) = n! / (k!(n‚àík)!)</div>
            <div class="desc">n —ç–ª–µ–º–µ–Ω—Ç—Ç–µ–Ω k —Ç–∞“£–¥–∞—É</div>
          </div>
          <div class="form-item">
            <div class="title">–°—ã–∑—ã“õ—Ç—ã“õ —Ñ—É–Ω–∫—Ü–∏—è</div>
            <div class="expr">y = kx + b</div>
            <div class="desc">k ‚Äî –±–∞“ì–∞–Ω—ã“£ “õ–∏—ã–ª—ã—Å—ã, b ‚Äî –æ—Ä—ã–Ω –∞—É—ã—Å—Ç—ã—Ä—É</div>
          </div>
        </div>
      </aside>
    </section>

    <footer>–ö“Ø–Ω/—Ç“Ø–Ω —Ä–µ–∂–∏–º—ñ —Å–∞“õ—Ç–∞–ª–∞–¥—ã. –§–æ–Ω-–¥–µ–∫–æ—Ä–∞—Ü–∏—è “±“õ—ã–ø—Ç—ã –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä—ã–ª“ì–∞–Ω ‚Äî —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä –º–µ–Ω –æ–π—ã–Ω–¥–∞—Ä “õ–∞–π—Ç–∞ “õ–æ—Å—ã–ª–¥—ã.</footer>
  </div>

  <!-- ===== Lightweight AI Chat widget (inserted for prototyping) ===== -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
  <div id="mb-ai-widget" aria-live="polite" style="position:fixed;right:18px;bottom:18px;z-index:99999;font-family:Inter,system-ui,Arial;">
    <button id="mb-ai-toggle" title="–ñ–ò –∫”©–º–µ–∫—à—ñ" aria-expanded="false" style="width:56px;height:56px;border-radius:50%;border:0;background:linear-gradient(135deg,#22d3ee,#7c3aed);color:#07101f;font-weight:800;font-size:16px;cursor:pointer;box-shadow:0 8px 28px rgba(0,0,0,.25);">–ñ–ò</button>

    <div id="mb-ai-panel" role="dialog" aria-hidden="true" style="display:none;width:380px;max-width:92vw;background:rgba(10,12,20,.96);color:#fff;border-radius:12px;margin-bottom:12px;box-shadow:0 20px 60px rgba(0,0,0,.5);overflow:hidden;">
      <div id="mb-ai-header" style="display:flex;justify-content:space-between;align-items:center;padding:12px 12px;border-bottom:1px solid rgba(255,255,255,.04);background:linear-gradient(90deg,#0b1220,rgba(255,255,255,.02));">
        <strong>MathBoard ‚Äî –ñ–ò –∫”©–º–µ–∫—à—ñ</strong>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="mb-ai-settingsBtn" title="–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä" style="background:transparent;border:0;color:inherit;cursor:pointer">‚öôÔ∏è</button>
          <button id="mb-ai-close" style="background:transparent;border:0;color:inherit;cursor:pointer">‚úï</button>
        </div>
      </div>

      <div id="mb-ai-body" style="padding:10px;display:flex;flex-direction:column;gap:8px;">
        <div id="mb-ai-messages" aria-live="polite" style="height:320px;overflow:auto;display:flex;flex-direction:column-reverse;gap:8px;padding:6px;"></div>

        <div id="mb-ai-controls" style="display:flex;gap:8px;">
          <input id="mb-ai-input" placeholder="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ —Å“±—Ä–∞“õ –∂–∞–∑ (–º—ã—Å: ‚à´ x dx, 2+2*5, sin(pi/3))"
                 style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;">
          <button id="mb-ai-send" style="padding:10px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,#22d3ee,#7c3aed);color:#07101f;font-weight:800;cursor:pointer;">–ñ—ñ–±–µ—Ä—É</button>
        </div>

        <div id="mb-ai-footer" style="font-size:12px;color:rgba(255,255,255,.7);">
          –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ –µ—Å–µ–ø—Ç–µ—É: Math.js ‚Äî –∂—ã–ª–¥–∞–º. OpenAI-“ì–∞ –∂—ñ–±–µ—Ä—É “Ø—à—ñ–Ω API –∫—ñ–ª—Ç—ñ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–≥–µ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.
        </div>
      </div>

      <div id="mb-ai-settings" aria-hidden="true" style="display:none;padding:10px;border-top:1px solid rgba(255,255,255,0.03);background:rgba(0,0,0,0.06);color:#fff;">
        <label style="font-size:13px;">OpenAI API –∫—ñ–ª—Ç—ñ (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å):
          <input id="mb-ai-apiKey" placeholder="sk-..." style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-top:6px;">
        </label>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button id="mb-ai-saveKey" style="padding:8px;border-radius:8px;background:linear-gradient(90deg,#22d3ee,#7c3aed);border:0;color:#07101f;cursor:pointer">–°–∞“õ—Ç–∞—É</button>
          <button id="mb-ai-clearKey" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.06);border:0;color:inherit;cursor:pointer">”®—à—ñ—Ä—É</button>
        </div>
        <div style="margin-top:8px;font-size:12px;color:#bbb">–ï–°–ö–ï–†–¢–£: –ö–ª–∏–µ–Ω—Ç –∂–∞“ì—ã–Ω–¥–∞ –∫—ñ–ª—Ç —Å–∞“õ—Ç–∞—É “õ–∞—É—ñ–ø—Å—ñ–∑ –µ–º–µ—Å. –ü—Ä–æ—Ç–æ—Ç–∏–ø “Ø—à—ñ–Ω “ì–∞–Ω–∞.</div>
      </div>
    </div>
  </div>

  <!-- Math.js and MathJax (for local eval & LaTeX rendering) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <script>
    // === Existing page scripts (canvas, carousel, theme) ===
    // Theme toggle, carousel, canvas & drawing logic from previous page
    (function(){
      // Theme toggle
      const THEME_KEY='mathboard_theme_v1';
      const themeBtn=document.getElementById('themeBtn');
      function applyTheme(t){
        document.body.setAttribute('data-theme', t==='day'?'day':'night');
        themeBtn.textContent = t==='day' ? '‚òÄÔ∏è –ö“Ø–Ω' : 'üåô –¢“Ø–Ω';
        localStorage.setItem(THEME_KEY,t);
      }
      applyTheme(localStorage.getItem(THEME_KEY) || 'night');
      themeBtn.addEventListener('click', ()=> applyTheme(document.body.dataset.theme==='day'?'night':'day'));

      // Carousel arrows / swipe
      const viewport = document.getElementById('viewport');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      function slideW(){ return parseInt(getComputedStyle(document.documentElement).getPropertyValue('--slide-w')) || 320; }
      prevBtn.addEventListener('click', ()=> viewport.scrollBy({left: - (slideW() + 12), behavior:'smooth'}));
      nextBtn.addEventListener('click', ()=> viewport.scrollBy({left: (slideW() + 12), behavior:'smooth'}));

      // Drag-to-scroll for viewport
      (function makeDraggable(el){
        let active=false,startX,scrollLeft;
        el.addEventListener('mousedown', e=> { active=true; startX=e.pageX - el.offsetLeft; scrollLeft=el.scrollLeft; el.style.cursor='grabbing'; });
        el.addEventListener('mouseleave', ()=>{ active=false; el.style.cursor=''; });
        el.addEventListener('mouseup', ()=>{ active=false; el.style.cursor=''; });
        el.addEventListener('mousemove', e=>{ if(!active) return; e.preventDefault(); const x = e.pageX - el.offsetLeft; const walk = (x - startX); el.scrollLeft = scrollLeft - walk; });
        // touch
        let tStartX=0,tScroll=0;
        el.addEventListener('touchstart', e=>{ tStartX = e.touches[0].pageX; tScroll = el.scrollLeft; }, {passive:true});
        el.addEventListener('touchmove', e=>{ const dx = e.touches[0].pageX - tStartX; el.scrollLeft = tScroll - dx; }, {passive:true});
      })(viewport);

      // Canvas draw
      const canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d');
      const modeEl=document.getElementById('mode'), sizeEl=document.getElementById('size'), colorEl=document.getElementById('color');
      let drawing=false,lastX=0,lastY=0,lineStart=null,history=[];
      function fitCanvas(){
        const r=canvas.getBoundingClientRect(), dpr=window.devicePixelRatio||1;
        canvas.width=Math.floor(r.width*dpr);
        canvas.height=Math.floor(r.height*dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
        if(history.length){
          const img=new Image(); img.onload=()=>ctx.drawImage(img,0,0,r.width,r.height); img.src=history[history.length-1];
        } else { ctx.clearRect(0,0,canvas.width,canvas.height); }
      }
      function snapshot(){ history.push(canvas.toDataURL()); if(history.length>12) history.shift(); }
      function getPos(e){ const r=canvas.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top; return {x,y}; }
      function start(e){ e.preventDefault(); const {x,y}=getPos(e); const mode=modeEl.value; if(mode==='line'){ if(!lineStart){ lineStart={x,y}; } else { snapshot(); ctx.save(); ctx.lineCap='round'; ctx.lineJoin='round'; ctx.lineWidth=+sizeEl.value; ctx.strokeStyle=colorEl.value; ctx.beginPath(); ctx.moveTo(lineStart.x,lineStart.y); ctx.lineTo(x,y); ctx.stroke(); ctx.restore(); lineStart=null; } return; } snapshot(); drawing=true; lastX=x; lastY=y; }
      function move(e){ if(!drawing) return; e.preventDefault(); const {x,y}=getPos(e); const mode=modeEl.value; ctx.save(); ctx.lineCap='round'; ctx.lineJoin='round'; ctx.lineWidth=+sizeEl.value; if(mode==='eraser'){ ctx.globalCompositeOperation='destination-out'; ctx.strokeStyle='rgba(0,0,0,1)'; } else { ctx.globalCompositeOperation='source-over'; ctx.strokeStyle=colorEl.value; } ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); ctx.stroke(); ctx.restore(); lastX=x; lastY=y; }
      function end(){ drawing=false; }
      document.getElementById('clearBtn').onclick=()=>{ snapshot(); ctx.clearRect(0,0,canvas.width,canvas.height); lineStart=null; };
      document.getElementById('undoBtn').onclick=()=>{ if(history.length<2) return; history.pop(); const img=new Image(); img.onload=()=>{ const r=canvas.getBoundingClientRect(); ctx.clearRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0,r.width,r.height); }; img.src=history[history.length-1]; lineStart=null; };
      canvas.addEventListener('mousedown',start); canvas.addEventListener('mousemove',move); window.addEventListener('mouseup',end);
      canvas.addEventListener('touchstart',start,{passive:false}); canvas.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',end);
      window.addEventListener('resize',fitCanvas);
      fitCanvas(); snapshot();
    })();
  </script>

  <!-- ===== Widget logic (Math.js + optional OpenAI client-side calls) ===== -->
  <script>
    (function(){
      const toggleBtn = document.getElementById('mb-ai-toggle');
      const panel = document.getElementById('mb-ai-panel');
      const closeBtn = document.getElementById('mb-ai-close');
      const sendBtn = document.getElementById('mb-ai-send');
      const input = document.getElementById('mb-ai-input');
      const messages = document.getElementById('mb-ai-messages');
      const settingsBtn = document.getElementById('mb-ai-settingsBtn');
      const settingsPane = document.getElementById('mb-ai-settings');
      const apiKeyInput = document.getElementById('mb-ai-apiKey');
      const saveKeyBtn = document.getElementById('mb-ai-saveKey');
      const clearKeyBtn = document.getElementById('mb-ai-clearKey');

      const STORAGE_KEY = 'mathboard_ai_apikey_v1';

      // Toggle panel
      toggleBtn.addEventListener('click', ()=>{
        const visible = panel.style.display === 'block';
        panel.style.display = visible ? 'none' : 'block';
        toggleBtn.setAttribute('aria-expanded', !visible);
        if(!visible) input.focus();
      });
      closeBtn.addEventListener('click', ()=>{ panel.style.display = 'none'; });

      settingsBtn.addEventListener('click', ()=>{
        const vis = settingsPane.style.display === 'block';
        settingsPane.style.display = vis ? 'none' : 'block';
      });

      // Load saved key (if any) into field
      const storedKey = localStorage.getItem(STORAGE_KEY);
      if(storedKey) apiKeyInput.value = storedKey;

      saveKeyBtn.addEventListener('click', ()=>{
        const k = apiKeyInput.value.trim();
        if(!k){ alert('–ö—ñ–ª—Ç –±–æ—Å ‚Äî –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ ”©—à—ñ—Ä—ñ“£—ñ–∑.'); return; }
        localStorage.setItem(STORAGE_KEY, k);
        alert('API –∫—ñ–ª—Ç—ñ —Å–∞“õ—Ç–∞–ª–¥—ã (–ª–æ–∫–∞–ªStorage). “ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫–∫–µ –Ω–∞–∑–∞—Ä –∞—É–¥–∞—Ä—ã“£—ã–∑.');
      });
      clearKeyBtn.addEventListener('click', ()=>{
        localStorage.removeItem(STORAGE_KEY);
        apiKeyInput.value='';
        alert('API –∫—ñ–ª—Ç—ñ ”©—à—ñ—Ä—ñ–ª–¥—ñ.');
      });

      function addMessageHTML(html, from='bot'){
        const el = document.createElement('div');
        el.className = 'mb-msg ' + (from==='user' ? 'user' : 'bot');
        el.style.padding = '8px';
        el.style.borderRadius = '8px';
        el.style.maxWidth = '100%';
        el.style.wordBreak = 'break-word';
        if(from==='user'){
          el.style.background = 'linear-gradient(90deg,#22d3ee20,#7c3aed20)';
          el.style.alignSelf = 'flex-end';
          el.style.color = '#07101f';
          el.style.fontWeight = '700';
        } else {
          el.style.background = 'rgba(255,255,255,0.03)';
          el.style.border = '1px solid rgba(255,255,255,0.04)';
          el.style.alignSelf = 'flex-start';
        }
        el.innerHTML = html;
        messages.prepend(el);
        if(window.MathJax && MathJax.typesetPromise){
          MathJax.typesetPromise([el]).catch(()=>{});
        }
      }

      function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

      // Try to evaluate locally using math.js
      function tryLocalEval(q){
        try {
          let expr = q.replaceAll('œÄ','pi').replaceAll('‚àö','sqrt').replaceAll('^','**');
          // allow letters for functions like sin, cos, log, but disallow suspicious chars
          const safe = /^[0-9+\-*/^()., %a-zA-ZœÄ‚àö]+$/.test(expr);
          if(!safe) return null;
          const res = math.evaluate(expr);
          return (typeof res === 'number' || typeof res === 'string' || math.typeOf(res) === 'BigNumber') ? res : String(res);
        } catch(e){ return null; }
      }

      // OpenAI direct call (client-side) ‚Äî prototyping only
      async function queryOpenAI(question){
        const key = localStorage.getItem(STORAGE_KEY);
        if(!key) throw new Error('API –∫—ñ–ª—Ç—ñ –∂–æ“õ (–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥–µ–Ω –æ—Ä–Ω–∞—Ç—ã“£—ã–∑).');
        const system = `–°—ñ–∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –æ“õ—ã—Ç—É—à—ã—Å—ã. –°“±—Ä–∞“õ“õ–∞ “õ–∞–∑–∞“õ—à–∞ “õ—ã—Å“õ–∞ ”ô—Ä—ñ –Ω–∞“õ—Ç—ã –∂–∞—É–∞–ø –±–µ—Ä—ñ“£—ñ–∑. –ï–≥–µ—Ä –µ—Å–µ–ø –±–æ–ª—Å–∞ ‚Äî —à–µ—à—É–¥—ñ“£ “õ–∞–¥–∞–º–¥–∞—Ä—ã–Ω LaTeX-—Ç–µ –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑.`;
        const payload = {
          model: "gpt-3.5-turbo",
          messages: [
            {role: "system", content: system},
            {role: "user", content: question}
          ],
          max_tokens: 800,
          temperature: 0.2
        };
        const resp = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + key },
          body: JSON.stringify(payload)
        });
        if(!resp.ok){
          const t = await resp.text();
          throw new Error('OpenAI “õ–∞—Ç–µ—Å—ñ: '+ resp.status + ' ‚Äî ' + t);
        }
        const data = await resp.json();
        const content = data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content;
        return content || '–ñ–∞—É–∞–ø —Ç–∞–±—ã–ª–º–∞–¥—ã.';
      }

      async function handleSend(){
        const q = input.value.trim();
        if(!q) return;
        addMessageHTML('<b>–°—ñ–∑:</b> ' + escapeHtml(q), 'user');
        input.value = '';
        const local = tryLocalEval(q);
        if(local !== null){
          addMessageHTML(`<b>–ñ–∞—É–∞–ø (–∂–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ):</b> \$${escapeHtml(String(local))}\$`, 'bot');
          return;
        }
        if(local === null && !localStorage.getItem(STORAGE_KEY)){
          addMessageHTML(`<b>–ñ–ò:</b> –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —à–µ—à—ñ–º —Ç–∞–±—ã–ª–º–∞–¥—ã. –ï–≥–µ—Ä —Ç–æ–ª—ã“õ –∂–∞—É–∞–ø “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥–µ–Ω OpenAI API –∫—ñ–ª—Ç—ñ–Ω “õ–æ–π—ã–ø, “õ–∞–π—Ç–∞–¥–∞–Ω –∂—ñ–±–µ—Ä—ñ“£—ñ–∑.`, 'bot');
          return;
        }
        addMessageHTML('<i>–ñ–∞—É–∞–ø —ñ–∑–¥–µ–ª—É–¥–µ...</i>', 'bot');
        try {
          const answer = await queryOpenAI(q);
          const safe = escapeHtml(answer).replace(/\n/g,'<br>');
          addMessageHTML(`<b>–ñ–ò:</b> ${safe}`, 'bot');
        } catch(err){
          addMessageHTML(`<b>“ö–∞—Ç–µ:</b> ${escapeHtml(err.message)}`, 'bot');
        }
      }

      sendBtn.addEventListener('click', handleSend);
      input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); handleSend(); } });

      // Welcome
      addMessageHTML('<b>–ñ–ò:</b> –°”ô–ª–µ–º! –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ —Å“±—Ä–∞“ì—ã“£—ã–∑ –±–∞—Ä –º–∞? (–º—ã—Å: 2+2*5, sqrt(121), ‚à´ x dx)');
      // Click message to copy
      messages.addEventListener('click', (e)=>{
        const m = e.target.closest('.mb-msg');
        if(!m) return;
        input.value = m.textContent.replace(/^–ñ–ò:|–°—ñ–∑:/g,'').trim();
      });
    })();
  </script>
</body>
</html>
