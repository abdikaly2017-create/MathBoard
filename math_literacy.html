<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ —Å–∞—É–∞—Ç—Ç—ã–ª—ã“õ ‚Äî 10 –Ω“±—Å“õ–∞ √ó 4 –≤–∞—Ä–∏–∞–Ω—Ç √ó 10 –µ—Å–µ–ø</title>
  <style>
    :root{
      --bg1:#e9f7ff;
      --bg2:#fff1f7;
      --card:#ffffffd8;
      --glass:#ffffffa5;
      --text:#0b1220;
      --muted:#4b5563;
      --primary:#2563eb;
      --primary2:#7c3aed;
      --radius:20px;
      --shadow:0 16px 52px #2563eb23;
      --soft:#eef2ff;
      --danger:#ef4444;
      --good:#22c55e;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:sans-serif;
      background:radial-gradient(1200px 600px at 10% 10%, #b8f3ff 0%,transparent 60%),
                 radial-gradient(900px 600px at 90% 25%, #ffd6e7 0%,transparent 55%),
                 linear-gradient(135deg, var(--bg1), var(--bg2));
      color:var(--text);
      min-height:100vh;
    }
    .container{max-width:1120px;margin:0 auto;padding:22px 14px 70px;}
    header{
      display:flex;justify-content:space-between;align-items:flex-start;gap:12px;
      padding:15px 16px;border-radius:var(--radius);
      background:var(--glass);box-shadow:var(--shadow);backdrop-filter:blur(12px);
      border:1px solid #dde6fa;
      margin-bottom:16px;
    }
    @media(max-width:900px){header{flex-direction:column;}}
    h1{margin:0;font-size:20px;}
    p{margin:6px 0 0;color:var(--muted);font-size:13px;}
    .btn{
      border:0;cursor:pointer;padding:10px 14px;border-radius:16px;
      font-weight:800;font-size:13px;background:#fff;color:#0f172a;
      box-shadow:0 9px 18px #115ded15;text-decoration:none;
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid #e0e7ef;
      user-select:none;
    }
    .btn.primary{color:#fff;background:linear-gradient(135deg,var(--primary),var(--primary2));border:0;}
    .btn.ghost{background:#ffffffb1;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .grid{display:grid;grid-template-columns:1.05fr 0.95fr;gap:12px;align-items:start;}
    @media(max-width:1000px){.grid{grid-template-columns:1fr;}}
    .card{
      padding:14px 16px;border-radius:var(--radius);
      background:var(--card);box-shadow:var(--shadow);
      border:1px solid #d8e3fa;
    }
    label{font-size:13px;color:var(--muted);}
    select,input{
      padding:9px 11px;border-radius:12px;border:1px solid #cfe0ff;background:#fff;
      font-size:13px;
    }
    .q{padding:10px 12px;border-radius:14px;background:#f7f9ff;border:1px solid #e5e7eb;margin:10px 0;}
    .q b{display:block;margin-bottom:7px;}
    .opt{display:block;margin:5px 0;font-size:13px;color:#111827;}
    .opt input{margin-right:8px;}
    .hint{font-size:12px;color:var(--muted);}
    .result{
      padding:10px 12px;border-radius:14px;background:var(--soft);border:1px dashed #a5b4fc;
      margin-top:10px;font-size:13px;
    }
    .small{font-size:12px;color:var(--muted);}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:12px;}
    th,td{border:1px solid #e5e7eb;padding:6px 8px;text-align:left;}
    th{background:#e0e7ff;}
    .good{color:var(--good);font-weight:800;}
    .bad{color:var(--danger);font-weight:800;}
    .chip{padding:6px 10px;border-radius:999px;background:#e0f2fe;font-size:12px;font-weight:700;}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ —Å–∞—É–∞—Ç—Ç—ã–ª—ã“õ</h1>
      <p>10 –Ω“±—Å“õ–∞ (1‚Äì10). ”ò—Ä –Ω“±—Å“õ–∞–¥–∞ 4 –≤–∞—Ä–∏–∞–Ω—Ç (A‚ÄìD), ”ô—Ä –≤–∞—Ä–∏–∞–Ω—Ç—Ç–∞ 10 —Å“±—Ä–∞“õ. –¢–µ–∫—Å–µ—Ä—É, –Ω”ô—Ç–∏–∂–µ–Ω—ñ –µ–Ω–≥—ñ–∑—É/—Å–∞“õ—Ç–∞—É.</p>
      <div class="row" style="margin-top:8px;">
        <span class="chip">10 –Ω“±—Å“õ–∞</span>
        <span class="chip">4 –≤–∞—Ä–∏–∞–Ω—Ç</span>
        <span class="chip">10 –µ—Å–µ–ø</span>
      </div>
    </div>
    <div class="row">
      <a class="btn ghost" href="index.html">‚Üê –ë–∞—Å—Ç—ã –±–µ—Ç</a>
      <button class="btn" id="resetAttemptBtn">–ñ–∞—É–∞–ø—Ç–∞—Ä–¥—ã —Ç–∞–∑–∞–ª–∞—É</button>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h2 style="margin:0 0 10px;">–¢–µ—Å—Ç</h2>

      <div class="row" style="margin-bottom:10px;">
        <label>–ù“±—Å“õ–∞:
          <select id="setSel"></select>
        </label>
        <label>–í–∞—Ä–∏–∞–Ω—Ç:
          <select id="varSel">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
          </select>
        </label>
        <button class="btn primary" id="loadBtn">–ñ“Ø–∫—Ç–µ—É</button>
      </div>

      <div id="testMeta" class="small"></div>
      <div id="questions"></div>

      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="checkBtn">‚úÖ –¢–µ–∫—Å–µ—Ä—É (10 –±–∞–ª–ª)</button>
        <button class="btn" id="showKeyBtn">üîé –î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä–¥—ã –∫”©—Ä—Å–µ—Ç—É</button>
      </div>

      <div class="result" id="testResult">–ù”ô—Ç–∏–∂–µ: ”ô–∑—ñ—Ä–≥–µ –∂–æ“õ</div>
      <div class="small">–ï—Å–∫–µ—Ä—Ç—É: –±“±–ª –±–µ—Ç ‚Äú“Ø–ª–≥—ñ-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä‚Äù. –ö–µ–π—ñ–Ω —Å“±—Ä–∞“õ—Ç–∞—Ä–¥—ã ”©–∑—ñ“£ “õ–∞–ª–∞“ì–∞–Ω–¥–∞–π –∞—É—ã—Å—Ç—ã—Ä–∞ –∞–ª–∞—Å—ã“£.</div>
    </section>

    <aside class="card">
      <h2 style="margin:0 0 10px;">–ù”ô—Ç–∏–∂–µ–ª–µ—Ä–¥—ñ –µ–Ω–≥—ñ–∑—É –∂”ô–Ω–µ —Å–∞“õ—Ç–∞—É</h2>

      <div class="row" style="margin-bottom:10px;">
        <label style="flex:1;">–û“õ—É—à—ã –∞—Ç—ã-–∂”©–Ω—ñ:
          <input id="studentName" placeholder="–ú—ã—Å: –ê–π–¥–æ—Å –°." style="width:100%;">
        </label>
      </div>

      <div class="row" style="margin-bottom:10px;">
        <label>–ù“±—Å“õ–∞:
          <select id="saveSetSel"></select>
        </label>
        <label>–í–∞—Ä–∏–∞–Ω—Ç:
          <select id="saveVarSel">
            <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option>
          </select>
        </label>
      </div>

      <div class="row" style="margin-bottom:10px;">
        <label>–ë–∞–ª–ª (0‚Äì10):
          <input id="manualScore" type="number" min="0" max="10" step="1" value="0" style="width:110px;">
        </label>
        <button class="btn primary" id="saveBtn">üíæ –°–∞“õ—Ç–∞—É</button>
      </div>

      <div class="small" id="saveMsg"></div>

      <h3 style="margin:14px 0 6px;">–°–∞“õ—Ç–∞–ª“ì–∞–Ω –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä</h3>
      <div class="row" style="margin-bottom:10px;">
        <button class="btn" id="refreshBtn">‚Üª –ñ–∞“£–∞—Ä—Ç—É</button>
        <button class="btn" id="clearAllBtn">üóë –ë–∞—Ä–ª—ã“ì—ã–Ω ”©—à—ñ—Ä—É</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>‚Ññ</th>
            <th>–ê—Ç—ã-–∂”©–Ω—ñ</th>
            <th>–ù“±—Å“õ–∞</th>
            <th>–í–∞—Ä–∏–∞–Ω—Ç</th>
            <th>–ë–∞–ª–ª</th>
            <th>–£–∞“õ—ã—Ç—ã</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </aside>
  </div>
</div>

<script>
  // ---------------------------
  // 1) –î–ï–†–ï–ö “ö“∞–†–´–õ–´–ú–´ (“Ø–ª–≥—ñ)
  // 10 –Ω“±—Å“õ–∞ √ó 4 –≤–∞—Ä–∏–∞–Ω—Ç √ó 10 –µ—Å–µ–ø
  // “ö–∞–∑—ñ—Ä —Å“±—Ä–∞“õ—Ç–∞—Ä "—à–∞–±–ª–æ–Ω" —Ç“Ø—Ä—ñ–Ω–¥–µ –∞–≤—Ç–æ–º–∞—Ç –∂–∞—Å–∞–ª–∞–¥—ã.
  // –°–µ–Ω “õ–∞–ª–∞—Å–∞“£, –∫–µ–π—ñ–Ω ”ô—Ä –Ω“±—Å“õ–∞/–≤–∞—Ä–∏–∞–Ω—Ç“õ–∞ –Ω–∞“õ—Ç—ã –º”ô—Ç—ñ–Ω–¥—ñ “õ–æ–ª–º–µ–Ω –∞—É—ã—Å—Ç—ã—Ä—ã–ø –±–µ—Ä–µ–º—ñ–Ω.
  // ---------------------------
  const SETS = 10;
  const VARS = ["A","B","C","D"];
  const QCOUNT = 10;

  // –î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä —à–∞–±–ª–æ–Ω—ã (”ô—Ä –≤–∞—Ä–∏–∞–Ω—Ç“õ–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ –±–æ–ª—Å—ã–Ω –¥–µ–ø –∞–π–Ω–∞–ª–¥—ã—Ä–∞–º—ã–∑)
  // A: 1,2,3,4... —Ü–∏–∫–ª, B: —ã“ì—ã—Å“õ–∞–Ω, —Ç.—Å.—Å.
  const baseKey = [0,1,2,3, 1,2,3,0, 2,3]; // 10 —Å“±—Ä–∞“õ, –∂–∞—É–∞–ø –∏–Ω–¥–µ–∫—Å—Ç–µ—Ä—ñ 0..3

  // –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã (”ô—Ä –Ω“±—Å“õ–∞/–≤–∞—Ä–∏–∞–Ω—Ç “Ø—à—ñ–Ω –±–∞—Å“õ–∞ —Å–∞–Ω–¥–∞—Ä/–∫–æ–Ω—Ç–µ–Ω—Ç —à—ã“ì–∞—Ä–∞–¥—ã)
  function makeTest(setNo, variant){
    const vShift = VARS.indexOf(variant); // 0..3
    const questions = [];

    for(let i=1;i<=QCOUNT;i++){
      // –ö–æ–Ω—Ç–µ–Ω—Ç—Ç—ñ "–º–∞—Ç.—Å–∞—É–∞—Ç" —Å—Ç–∏–ª—ñ–Ω–¥–µ: –ø–∞–π—ã–∑, –ø—Ä–æ–ø–æ—Ä—Ü–∏—è, –∂—ã–ª–¥–∞–º–¥—ã“õ, –æ—Ä—Ç–∞—à–∞, –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ç.–±.
      // (–ë“±–ª –∂–µ—Ä–¥–µ “õ—ã—Å“õ–∞, –æ—Ä—Ç–∞“õ “Ø–ª–≥—ñ. –ö–µ–π—ñ–Ω —Å–µ–Ω –Ω–∞“õ—Ç—ã 100 –µ—Å–µ–ø –º”ô—Ç—ñ–Ω—ñ–Ω –±–µ—Ä—Å–µ“£, –æ—Å—ã–Ω—ã —Å–æ“ì–∞–Ω –∞—É—ã—Å—Ç—ã—Ä–∞–º.)
      const seed = setNo*100 + vShift*25 + i*7;

      // 4 —Ç“Ø—Ä–ª—ñ —Ç–∏–ø—Ç—ñ –∞–π–Ω–∞–ª–¥—ã—Ä—ã–ø –±–µ—Ä–µ–º—ñ–∑:
      const type = (i + setNo + vShift) % 4;

      let qText = "";
      let opts = [];
      let correct = (baseKey[i-1] + vShift) % 4;

      if(type === 0){
        const a = (seed % 40) + 10; // 10..49
        const b = (seed % 9) + 2;   // 2..10
        qText = `${i}) –î“Ø–∫–µ–Ω–¥–µ ${a} —Ç–µ“£–≥–µ —Ç“±—Ä–∞—Ç—ã–Ω –∑–∞—Ç“õ–∞ ${b*10}% –∂–µ“£—ñ–ª–¥—ñ–∫ –∂–∞—Å–∞–ª–¥—ã. –ñ–µ“£—ñ–ª–¥—ñ–∫—Ç–µ–Ω –∫–µ–π—ñ–Ω–≥—ñ –±–∞“ì–∞—Å—ã “õ–∞–Ω—à–∞ —Ç–µ“£–≥–µ?`;
        const ans = Math.round(a*(1 - (b*10)/100));
        // 4 –Ω“±—Å“õ–∞
        opts = [ans, ans + 2, ans - 3, ans + 5].map(x=>String(x));
        correct = 0;
      } else if(type === 1){
        const d = (seed % 9) + 2; // 2..10
        const t = (seed % 6) + 2; // 2..7
        qText = `${i}) –ê–≤—Ç–æ–∫”©–ª—ñ–∫ ${t} —Å–∞“ì–∞—Ç—Ç–∞ ${d*30} –∫–º –∂“Ø—Ä–¥—ñ. –û—Ä—Ç–∞—à–∞ –∂—ã–ª–¥–∞–º–¥—ã“ì—ã (–∫–º/—Å–∞“ì) “õ–∞–Ω—à–∞?`;
        const ans = (d*30)/t;
        opts = [ans, ans+5, ans-3, ans+2].map(x=>String(x));
        correct = 0;
      } else if(type === 2){
        const x = (seed % 20) + 5; // 5..24
        const y = (seed % 15) + 10; // 10..24
        qText = `${i}) –ë—ñ—Ä “õ–æ—Ä–∞–ø—Ç–∞ ${x} “õ–∞–ª–∞–º, –∞–ª –µ–∫—ñ–Ω—à—ñ “õ–æ—Ä–∞–ø—Ç–∞ ${y} “õ–∞–ª–∞–º –±–∞—Ä. –ï–∫–µ—É—ñ–Ω–¥–µ –±–∞—Ä–ª—ã“ì—ã –Ω–µ—à–µ “õ–∞–ª–∞–º?`;
        const ans = x+y;
        opts = [ans, ans+1, ans-2, ans+5].map(String);
        correct = 0;
      } else {
        const p = (seed % 8) + 2; // 2..9
        const q = (seed % 7) + 3; // 3..9
        qText = `${i}) –ï–≥–µ—Ä 1 –∫–≥ –∞–ª–º–∞ ${p*100} —Ç–≥ –±–æ–ª—Å–∞, ${q} –∫–≥ –∞–ª–º–∞ “õ–∞–Ω—à–∞ —Ç–µ“£–≥–µ —Ç“±—Ä–∞–¥—ã?`;
        const ans = p*100*q;
        opts = [ans, ans + 100, ans - 200, ans + 300].map(String);
        correct = 0;
      }

      // correct-—Ç—ã –≤–∞—Ä–∏–∞–Ω—Ç“õ–∞ “õ–∞—Ä–∞–π "–∞—Ä–∞–ª–∞—Å—Ç—ã—Ä–∞–π—ã“õ": opts-—Ç—ã shuffle –∂–∞—Å–∞–ø,
      // –¥“±—Ä—ã—Å –∂–∞—É–∞–±—ã–Ω –¥“±—Ä—ã—Å –∏–Ω–¥–µ–∫—Å—ñ–º–µ–Ω “±—Å—Ç–∞–ø “õ–∞–ª–∞–º—ã–∑.
      const rightVal = opts[0];
      // "–∫”©—Ä—ñ–Ω–µ—Ç—ñ–Ω" –¥“±—Ä—ã—Å –Ω“±—Å“õ–∞–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç“õ–∞ —Ç”ô—É–µ–ª–¥—ñ “õ—ã–ª–∞–º—ã–∑:
      const perm = permByShift(vShift); // [..] —Ç”©—Ä—Ç –æ–ø—Ü–∏—è“ì–∞ permutation
      const newOpts = perm.map(pi => opts[pi]);
      const newCorrect = perm.indexOf(0); // opts[0] “õ–∞–π –∂–µ—Ä–¥–µ —Ç“±—Ä?

      questions.push({
        text: qText,
        options: newOpts,
        correct: newCorrect,
        answerText: rightVal
      });
    }

    return { setNo, variant, questions };
  }

  // 4 —ç–ª–µ–º–µ–Ω—Ç permutation (–≤–∞—Ä–∏–∞–Ω—Ç“õ–∞ “õ–∞—Ä–∞–π –Ω“±—Å“õ–∞ —Ä–µ—Ç—ñ ”©–∑–≥–µ—Ä–µ–¥—ñ)
  function permByShift(shift){
    const perms = [
      [0,1,2,3], // A
      [1,2,3,0], // B
      [2,3,0,1], // C
      [3,0,1,2]  // D
    ];
    return perms[shift] || perms[0];
  }

  // ---------------------------
  // 2) UI: select —Ç–æ–ª—Ç—ã—Ä—É
  // ---------------------------
  const setSel = document.getElementById('setSel');
  const saveSetSel = document.getElementById('saveSetSel');
  for(let i=1;i<=SETS;i++){
    setSel.innerHTML += `<option value="${i}">${i}-–Ω“±—Å“õ–∞</option>`;
    saveSetSel.innerHTML += `<option value="${i}">${i}-–Ω“±—Å“õ–∞</option>`;
  }
  setSel.value = "1";
  saveSetSel.value = "1";

  const varSel = document.getElementById('varSel');
  const saveVarSel = document.getElementById('saveVarSel');

  // ---------------------------
  // 3) –†–ï–ù–î–ï–† / –°–ê“ö–¢–ê–£ (–∂–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ –∂–∞—É–∞–ø—Ç–∞—Ä)
  // ---------------------------
  const questionsEl = document.getElementById('questions');
  const testMeta = document.getElementById('testMeta');
  const testResult = document.getElementById('testResult');

  const STORAGE_ATTEMPT = "math_lit_attempt_v1";
  const STORAGE_RESULTS = "math_lit_results_v1";

  function attemptKey(setNo, variant){
    return `${setNo}_${variant}`;
  }

  function loadAttemptMap(){
    try{
      const raw = localStorage.getItem(STORAGE_ATTEMPT);
      const obj = raw ? JSON.parse(raw) : {};
      return (obj && typeof obj === 'object') ? obj : {};
    }catch(e){ return {}; }
  }
  function saveAttemptMap(map){
    localStorage.setItem(STORAGE_ATTEMPT, JSON.stringify(map));
  }

  function renderTest(){
    const setNo = Number(setSel.value);
    const variant = varSel.value;
    const test = makeTest(setNo, variant);

    testMeta.textContent = `“ö–∞–∑—ñ—Ä: ${setNo}-–Ω“±—Å“õ–∞, ${variant} –≤–∞—Ä–∏–∞–Ω—Ç. –ë–∞—Ä–ª—ã“ì—ã: 10 —Å“±—Ä–∞“õ.`;

    const attempts = loadAttemptMap();
    const key = attemptKey(setNo, variant);
    const saved = attempts[key] || {}; // {q1: idx, q2: idx...}

    questionsEl.innerHTML = test.questions.map((q, idx)=>{
      const qNo = idx+1;
      const name = `q_${qNo}`;
      const chosen = saved[name]; // 0..3
      const optsHtml = q.options.map((op, oi)=>{
        const checked = (chosen === oi) ? "checked" : "";
        return `<label class="opt"><input type="radio" name="${name}" value="${oi}" ${checked}> ${String.fromCharCode(65+oi)}) ${op}</label>`;
      }).join("");
      return `
        <div class="q" data-qno="${qNo}">
          <b>${q.text}</b>
          ${optsHtml}
          <div class="hint" id="fb_${qNo}"></div>
        </div>
      `;
    }).join("");

    // –†–∞–¥–∏–æ ”©–∑–≥–µ—Ä—ñ—Å—ñ–Ω —Å–∞“õ—Ç–∞–ø –æ—Ç—ã—Ä—É
    questionsEl.querySelectorAll('input[type="radio"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        const attempts = loadAttemptMap();
        const key = attemptKey(Number(setSel.value), varSel.value);
        attempts[key] = attempts[key] || {};
        attempts[key][r.name] = Number(r.value);
        saveAttemptMap(attempts);
      });
    });

    testResult.textContent = "–ù”ô—Ç–∏–∂–µ: ”ô–∑—ñ—Ä–≥–µ –∂–æ“õ";
  }

  document.getElementById('loadBtn').addEventListener('click', ()=>{
    renderTest();
    // –æ“£ –∂–∞“õ—Ç–∞“ì—ã "“õ–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É" select-—Ç–µ—Ä—ñ–Ω –¥–µ —Å–∏–Ω—Ö—Ä–æ–Ω–¥–∞–π—ã“õ:
    saveSetSel.value = setSel.value;
    saveVarSel.value = varSel.value;
  });

  // –ê–ª“ì–∞—à“õ—ã —Ä–µ–Ω–¥–µ—Ä
  renderTest();

  // ---------------------------
  // 4) –¢–ï–ö–°–ï–†–£ (10 –±–∞–ª–ª)
  // ---------------------------
  function checkTest(showKey=false){
    const setNo = Number(setSel.value);
    const variant = varSel.value;
    const test = makeTest(setNo, variant);

    let score = 0;

    for(let i=1;i<=QCOUNT;i++){
      const q = test.questions[i-1];
      const sel = document.querySelector(`input[name="q_${i}"]:checked`);
      const fb = document.getElementById(`fb_${i}`);

      if(!sel){
        fb.textContent = showKey ? `–î“±—Ä—ã—Å: ${String.fromCharCode(65+q.correct)}) ${q.answerText}` : "–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞–ª–º–∞“ì–∞–Ω.";
        fb.className = "hint bad";
        continue;
      }

      const chosen = Number(sel.value);
      if(chosen === q.correct){
        score++;
        fb.textContent = showKey ? `–î“±—Ä—ã—Å! (${String.fromCharCode(65+q.correct)})` : "–î“±—Ä—ã—Å!";
        fb.className = "hint good";
      }else{
        fb.textContent = showKey
          ? `“ö–∞—Ç–µ. –î“±—Ä—ã—Å: ${String.fromCharCode(65+q.correct)}) ${q.answerText}`
          : "“ö–∞—Ç–µ.";
        fb.className = "hint bad";
      }
    }

    testResult.innerHTML = `–ù”ô—Ç–∏–∂–µ: <b>${score}/10</b> –±–∞–ª–ª.`;
    // –ê–≤—Ç–æ —Ç“Ø—Ä–¥–µ "“õ–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É" ”©—Ä—ñ—Å—ñ–Ω–µ “õ–æ—è–π—ã“õ
    document.getElementById('manualScore').value = score;
    // –°–∏–Ω—Ö—Ä–æ–Ω
    saveSetSel.value = setSel.value;
    saveVarSel.value = varSel.value;

    return score;
  }

  document.getElementById('checkBtn').addEventListener('click', ()=>checkTest(false));
  document.getElementById('showKeyBtn').addEventListener('click', ()=>checkTest(true));

  // ---------------------------
  // 5) –ñ–ê–£–ê–ü–¢–ê–†–î–´ –¢–ê–ó–ê–õ–ê–£
  // ---------------------------
  document.getElementById('resetAttemptBtn').addEventListener('click', ()=>{
    const setNo = Number(setSel.value);
    const variant = varSel.value;
    const attempts = loadAttemptMap();
    delete attempts[attemptKey(setNo, variant)];
    saveAttemptMap(attempts);
    renderTest();
  });

  // ---------------------------
  // 6) –ù”ò–¢–ò–ñ–ï–ù–Ü –°–ê“ö–¢–ê–£ (manual + auto)
  // ---------------------------
  function loadResults(){
    try{
      const raw = localStorage.getItem(STORAGE_RESULTS);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    }catch(e){ return []; }
  }
  function saveResults(arr){
    localStorage.setItem(STORAGE_RESULTS, JSON.stringify(arr));
  }

  function renderResults(){
    const rows = document.getElementById('rows');
    const arr = loadResults();
    rows.innerHTML = arr.map((r, idx)=>`
      <tr>
        <td>${idx+1}</td>
        <td>${r.name}</td>
        <td>${r.setNo}</td>
        <td>${r.variant}</td>
        <td>${r.score}</td>
        <td>${r.time}</td>
      </tr>
    `).join("");
  }
  renderResults();

  document.getElementById('saveBtn').addEventListener('click', ()=>{
    const name = document.getElementById('studentName').value.trim();
    const setNo = Number(saveSetSel.value);
    const variant = saveVarSel.value;
    const score = Number(document.getElementById('manualScore').value);

    const msg = document.getElementById('saveMsg');
    msg.textContent = "";
    msg.className = "small";

    if(!name){
      msg.textContent = "–ê—Ç—ã-–∂”©–Ω—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.";
      msg.className = "small bad";
      return;
    }
    if(!Number.isFinite(score) || score < 0 || score > 10){
      msg.textContent = "–ë–∞–ª–ª 0‚Äì10 –∞—Ä–∞–ª—ã“ì—ã–Ω–¥–∞ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.";
      msg.className = "small bad";
      return;
    }

    const now = new Date();
    const time = now.toLocaleString('kk-KZ',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});

    const arr = loadResults();
    arr.push({ name, setNo, variant, score, time });
    saveResults(arr);
    renderResults();

    msg.textContent = "–ù”ô—Ç–∏–∂–µ —Å–∞“õ—Ç–∞–ª–¥—ã.";
    msg.className = "small good";
  });

  document.getElementById('refreshBtn').addEventListener('click', renderResults);

  document.getElementById('clearAllBtn').addEventListener('click', ()=>{
    if(confirm("–ë–∞—Ä–ª—ã“õ —Å–∞“õ—Ç–∞–ª“ì–∞–Ω –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä ”©—à—ñ—Ä—ñ–ª—Å—ñ–Ω –±–µ?")){
      saveResults([]);
      renderResults();
      const msg = document.getElementById('saveMsg');
      msg.textContent = "–ë–∞—Ä–ª—ã“ì—ã ”©—à—ñ—Ä—ñ–ª–¥—ñ.";
      msg.className = "small";
    }
  });
</script>
</body>
</html>
