<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>–ì–µ–æ–º–µ—Ç—Ä–∏—è (–ø–ª–∞–Ω–∏–º–µ—Ç—Ä–∏—è) ‚Äî —Ç–µ—Å—Ç, —Ç–∞“õ—Ç–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{--card:#fff;--bg:#f6f8fa;--muted:#1e293b;--accent:#6366f1;--danger:#ef4444;--good:#22c55e;}
    body{margin:0;background:var(--bg);font-family:sans-serif;}
    .container{max-width:1120px;margin:0 auto;padding:20px 12px 65px;}
    header{display:flex;justify-content:space-between;align-items:flex-start;gap:14px;margin-bottom:18px;padding:13px 15px;background:var(--card);box-shadow:0 1px 15px #6366f144;border-radius:17px;}
    @media(max-width:990px){header{flex-direction:column;}}
    .title h1{margin:0 0 6px;font-size:21px;color:var(--accent);}
    .title p{margin:1px 0 6px 0;color:var(--muted);font-size:13px;}
    .badge-row{display:flex;gap:8px;margin-bottom:5px;}
    .badge{padding:5px 8px;border-radius:99px;background:#e0e7ff;color:#3730a3;font-size:12px;}
    nav a{font-size:13px;color:var(--accent);margin-right:10px;}
    .timer-box{min-width:200px;padding:9px 13px;background:var(--accent);color:#fff;border-radius:14px;box-shadow:0 0 18px #6366f144;}
    .timer-time{font-size:25px;font-weight:900;}
    .timer-status{font-size:13px;}
    main{display:grid;grid-template-columns: 1.06fr 0.94fr;gap:14px;align-items:flex-start;}
    @media(max-width:980px){main{grid-template-columns:1fr;}}
    .card{background:var(--card);border-radius:16px;padding:14px 20px;margin-bottom:17px;box-shadow:0 2px 13px #6366f144;}
    h2{margin-top:0;}
    h3{margin-top:15px;}
    .formula{background:#e0e7ff;border-radius:999px;padding:4px 11px;font-size:13px;font-weight:700;color:#4f46e5;}
    .ex{background:#f8fafc;padding:9px 13px 10px 17px;border-radius:10px;font-size:13px;}
    .board{background:#fff;padding:10px 9px 15px;border-radius:14px;margin-bottom:13px;}
    .tools{display:flex;gap:7px;align-items:center;}
    .tools .tool{padding:5px 9px;border-radius:9px;background:#e0e7ff;font-size:13px;font-weight:700;}
    canvas{width:100%;height:180px;border-radius:12px;background:#e7e8fd;border:1px solid #bfd6fb;}
    .calc{background:#f5f8fb;padding:11px 13px 13px;border-radius:12px;}
    .calc select, .calc input{padding:7px 11px;border-radius:9px;border:1px solid #a5b4fc;margin-bottom:7px;}
    .calc .out{background:var(--accent);color:#fff;padding:7px 9px;border-radius:7px;margin-top:4px;font-size:13px;}
    .question{margin-bottom:12px;padding:9px 11px;background:#eef1fa;border-radius:11px;}
    .question-title{font-weight:700;margin-bottom:6px;}
    label.option{display:block;font-size:13px;margin-bottom:3px;}
    .small-feedback{font-size:12px;margin-top:3px;}
    .small-feedback.correct{color:var(--good);}
    .small-feedback.wrong{color:var(--danger);}
    .test-result{padding:8px 12px;border-radius:10px;background:#dde9ff;font-size:13px;margin:8px 0;}
    .match-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .match-item{padding:7px 10px;border-radius:7px;background:#ecf1ff;margin:5px 0;}
    .match-item input{width:38px;border-radius:6px;}
    .save-box{margin-top:10px;padding:7px 11px;border-radius:10px;background:#f5f5fa;display:flex;gap:7px;align-items:center;}
    .save-box input{padding:6px 10px;font-size:13px;border-radius:999px;border:1px solid #a5b4fc;min-width:130px;}
    .saved-table{width:100%;border-collapse:collapse;margin-top:7px;font-size:12px;}
    .saved-table th,.saved-table td{border:1px solid #e0e7ff;padding:4px 6px;}
    .saved-table th{background:#e0e7ff;}
    .chip{padding:5px 8px;border-radius:99px;background:#e0e7ff;font-size:12px;}
    footer{margin-top:16px;}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="title">
      <h1>–ì–µ–æ–º–µ—Ç—Ä–∏—è (–ø–ª–∞–Ω–∏–º–µ—Ç—Ä–∏—è) ‚Äî —Ç–µ—Å—Ç, —Ç–∞“õ—Ç–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
      <p>“Æ—à–±“±—Ä—ã—à, —Ç”©—Ä—Ç–±“±—Ä—ã—à, –∫–≤–∞–¥—Ä–∞—Ç, —à–µ“£–±–µ—Ä, —Ñ–æ—Ä–º—É–ª–∞, –æ–Ω–ª–∞–π–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ñ–∏–≥—É—Ä–∞.</p>
      <div class="badge-row">
        <span class="badge">8‚Äì9 —Å—ã–Ω—ã–ø</span>
        <span class="badge">–§–∏–≥—É—Ä–∞ —Å–∞–ª—É</span>
        <span class="badge">15 –º–∏–Ω —Ç–µ—Å—Ç</span>
      </div>
      <nav>
        <a href="index.html">‚Üê –ë–∞—Å—Ç—ã –±–µ—Ç</a>
        <a href="trig.html">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</a>
      </nav>
    </div>
    <div class="timer-box">
      <div style="font-size:12px;margin-bottom:3px;">–£–∞“õ—ã—Ç—ã: 15 –º–∏–Ω</div>
      <div class="timer-time" id="timerDisplay">15:00</div>
      <div class="timer-status" id="timerStatus">–û—Ä—ã–Ω–¥–∞—É —É–∞“õ—ã—Ç—ã –∂“Ø—Ä—ñ–ø –∂–∞—Ç—ã—Ä</div>
      <button id="restartTimerBtn" style="margin-top:5px;border-radius:8px;padding:5px 9px;border:0;cursor:pointer;">‚è± 15 –º–∏–Ω “õ–∞–π—Ç–∞ “õ–æ—Å</button>
    </div>
  </header>
  <main>
    <section>
      <div class="card">
        <h2>–¢–µ–æ—Ä–∏—è –∂”ô–Ω–µ —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä</h2>
        <span class="formula">S_{“Ø—à–±} = ¬Ω a¬∑h</span> ‚Äî “Ø—à–±“±—Ä—ã—à <br>
        <span class="formula">S_{—Ç”©—Ä—Ç–±} = a¬∑b</span> ‚Äî —Ç—ñ–∫—Ç”©—Ä—Ç–±“±—Ä—ã—à &emsp;
        <span class="formula">S_{–∫–≤–∞–¥—Ä} = a¬≤</span> <br>
        <span class="formula">C = 2œÄr</span> &nbsp; <span class="formula">S_{—à–µ“£–±} = œÄr¬≤</span>
        <div class="ex"><b>–ú—ã—Å–∞–ª 1:</b> “Æ—à–±“±—Ä—ã—à (a=6, h=5): S=0.5√ó6√ó5=15</div>
        <div class="ex"><b>–ú—ã—Å–∞–ª 2:</b> –¢—ñ–∫ —Ç”©—Ä—Ç–±“±—Ä—ã—à (a=7, b=3): S=21</div>
        <div class="ex"><b>–ú—ã—Å–∞–ª 3:</b> –®–µ“£–±–µ—Ä (r=4): S=3.14√ó16‚âà50.24</div>
      </div>
      <div class="card calc">
        <b>–û–Ω–ª–∞–π–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∂”ô–Ω–µ —Ñ–∏–≥—É—Ä–∞ —Å–∞–ª—É</b>
        <span class="chip">–º”ô–Ω –µ–Ω–≥—ñ–∑—Å–µ“£, —Ñ–∏–≥—É—Ä–∞ —à—ã“ì–∞–¥—ã</span><br>
        <select id="figType">
          <option value="tri">“Æ—à–±“±—Ä—ã—à (a, h)</option>
          <option value="rect">–¢—ñ–∫ —Ç”©—Ä—Ç–±“±—Ä—ã—à (a, b)</option>
          <option value="sq">–ö–≤–∞–¥—Ä–∞—Ç (a)</option>
          <option value="circle">–®–µ“£–±–µ—Ä (r)</option>
        </select>
        <span id="figFields"></span>
        <button id="figCalcBtn">‚éå –ï—Å–µ–ø—Ç–µ—É –∂”ô–Ω–µ —Å–∞–ª—É</button>
        <span id="figCalcOut" class="out"></span>
      </div>
      <div class="card board">
        <div class="tools">
          <div class="tool">–†–µ–∂–∏–º: <select id="mode"><option value="pen">“ö–∞–ª–∞–º</option><option value="eraser">”®—à—ñ—Ä–≥—ñ—à</option><option value="line">–°—ã–∑“ì—ã—à</option></select></div>
          <div class="tool">“ö–∞–ª—ã“£–¥—ã“ì—ã <input id="size" type="range" min="2" max="15" value="4"></div>
          <div class="tool">–¢“Ø—Å <input id="color" type="color" value="#6366f1"></div>
          <button id="undoBtn" class="tool">‚Ü∂ Undo</button>
          <button id="clearBtn" class="tool">üßΩ –¢–∞–∑–∞–ª–∞—É</button>
        </div>
        <canvas id="canvas" style="background:#e7e8fd;"></canvas>
      </div>
    </section>
    <section>
      <div class="card">
        <h2>–¢–µ—Å—Ç (10 —Å“±—Ä–∞“õ, 10 –±–∞–ª–ª)</h2>
        <div id="testArea"></div>
        <div class="test-result" id="testResult"></div>
        <h2 style="margin-top:15px;">–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É (5 –∂“±–ø)</h2>
        <div class="match-grid" id="matchArea"></div>
        <div class="test-result" id="matchResult"></div>
        <h2>–¢–µ–∫—Å–µ—Ä—É –∂”ô–Ω–µ –Ω”ô—Ç–∏–∂–µ —Å–∞“õ—Ç–∞—É</h2>
        <div class="save-box">
          <span id="scoreSummary">–ñ–∞–ª–ø—ã –±–∞–ª–ª: ”ô–ª—ñ –µ—Å–µ–ø—Ç–µ–ª–≥–µ–Ω –∂–æ“õ</span>
          <button id="checkAllBtn" style="margin:3px 8px;">‚úÖ –¢–µ–∫—Å–µ—Ä—É</button>
          <label>–ê—Ç—ã-–∂”©–Ω—ñ:<input id="studentName"/></label>
          <button id="saveResultBtn">üíæ –°–∞“õ—Ç–∞—É</button>
        </div>
        <div style="color:var(--muted);font-size:12px;margin:3px 0;" id="saveMessage"></div>
        <table class="saved-table" id="resultsTable">
          <thead><tr><th>‚Ññ</th><th>–ê—Ç—ã-–∂”©–Ω—ñ</th><th>–ë–∞–ª–ª</th><th>–£–∞“õ—ã—Ç—ã</th><th>“ö–∞–ª“ì–∞–Ω —É–∞“õ.</th></tr></thead>
          <tbody></tbody>
        </table>
        <button id="clearResultsBtn" style="margin-top:6px;">üóë –¢–∞–∑–∞–ª–∞—É</button>
      </div>
    </section>
  </main>
  <footer>
    –§–∏–≥—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —Å—ã–∑—ã–ª–∞–¥—ã. –ë–∞—Å—Ç—ã –±–µ—Ç ‚Äî index.html –∞—Ä“õ—ã–ª—ã ”©—Ç–µ—Å—ñ“£.
  </footer>
</div>
<script>
  // –¢–∞–π–º–µ—Ä
  const TIMER_SEC = 15*60; let remaining=TIMER_SEC,timerId=null;
  const timerDisplay=document.getElementById('timerDisplay'),timerStatus=document.getElementById('timerStatus'),restartTimerBtn=document.getElementById('restartTimerBtn');
  function ftime(sec){let m=Math.floor(sec/60),s=sec%60;return String(m).padStart(2,0)+':'+String(s).padStart(2,0);}
  function updateTimerUI(){timerDisplay.textContent=ftime(remaining);
    if(remaining<=0){timerStatus.textContent='–£–∞“õ—ã—Ç –∞—è“õ—Ç–∞–ª–¥—ã.';clearInterval(timerId);timerId=null;}
    else if(remaining<=180){timerStatus.textContent='“ö–∞–ª“ì–∞–Ω —É–∞“õ—ã—Ç –∞–∑! –ñ—ã–ª–¥–∞–º!';}
    else timerStatus.textContent='–û—Ä—ã–Ω–¥–∞—É —É–∞“õ—ã—Ç—ã –∂“Ø—Ä—ñ–ø –∂–∞—Ç—ã—Ä';}
  function startTimer(){if(timerId)clearInterval(timerId);remaining=TIMER_SEC;updateTimerUI();
    timerId=setInterval(()=>{remaining--;updateTimerUI();if(remaining<=0)clearInterval(timerId);},1000);}
  restartTimerBtn.onclick=startTimer;startTimer();

  // TEST
  const testQuestions=[
    {q:"1) –¢—ñ–∫ –±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç—ã“£ –∞—É–¥–∞–Ω—ã “õ–∞–ª–∞–π —Ç–∞–±—ã–ª–∞–¥—ã?",
     options:["a¬∑b","a¬∑h","¬Ωa¬∑h","a¬≤"],correct:2},
    {q:"2) –ö–≤–∞–¥—Ä–∞—Ç—Ç—ã“£ –∞—É–¥–∞–Ω—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
     options:["a+a","2a","a¬≤","a¬∑b"],correct:2},
    {q:"3) –®–µ“£–±–µ—Ä “±–∑—ã–Ω–¥—ã“ì—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
     options:["œÄr¬≤","2œÄr","a¬≤","r¬≤"],correct:1},
    {q:"4) –¢—ñ–∫ —Ç”©—Ä—Ç–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã 5—Å–º, –µ–Ω—ñ a=1—Å–º –±–æ–ª—Å–∞, b=?",options:["3—Å–º","5—Å–º","4—Å–º","5—Å–º¬≤"],correct:1},
    {q:"5) –†–∞–¥–∏—É—Å—ã r=3—Å–º —à–µ“£–±–µ—Ä–¥—ñ“£ –∞—É–¥–∞–Ω—ã?",options:["28.26—Å–º¬≤","9—Å–º¬≤","18.84—Å–º¬≤","6—Å–º¬≤"],correct:0},
    {q:"6) –¢—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç—ã“£ –∫–∞—Ç–µ—Ç—Ç–µ—Ä—ñ a=6, b=8. –ì–∏–ø–æ—Ç–µ–Ω—É–∑–∞?",
    options:["10","12","8","14"],correct:0},
    {q:"7) –ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–Ω—ã“£ –∞—É–¥–∞–Ω—ã “õ–∞–ª–∞–π —Ç–∞–±—ã–ª–∞–¥—ã?",options:["a¬∑b","a¬∑h","a¬≤","2a+2b"],correct:1},
    {q:"8) –ö–≤–∞–¥—Ä–∞—Ç—Ç—ã“£ –¥–∏–∞–≥–æ–Ω–∞–ª—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",options:["a¬≤","a¬∑‚àö2","2a","a/2"],correct:1},
    {q:"9) “Æ—à–±“±—Ä—ã—à—Ç—ã“£ –∞—É–¥–∞–Ω—ã –¥–∞ ”ô—Ä“õ–∞—à–∞–Ω –±“Ø—Ç—ñ–Ω —Å–∞–Ω –±–æ–ª–∞ –º–∞?",options:["–ò”ô","–ñ–æ“õ","–¢–µ–∫ a –±“Ø—Ç—ñ–Ω –±–æ–ª—Å–∞","–¢–µ–∫ h –±“Ø—Ç—ñ–Ω –±–æ–ª—Å–∞"],correct:1},
    {q:"10) –ü–µ—Ä–∏–º–µ—Ç—Ä ‚Äî –±“±–ª...",options:["–ê—É–¥–∞–Ω","–ë“±—Ä—ã—à","–§–∏–≥—É—Ä–∞–Ω—ã“£ —à–µ—Ç—ñ–Ω–¥–µ–≥—ñ “±–∑—ã–Ω–¥—ã“õ “õ–æ—Å—ã–Ω–¥—ã—Å—ã","–ë–∏—ñ–∫—Ç—ñ–∫"],correct:2},
  ];
  const testArea=document.getElementById('testArea');
  function renderTest(){
    testArea.innerHTML = '';
    testQuestions.forEach((q, idx) => {
      const div = document.createElement('div');
      div.className = 'question';
      div.dataset.index = idx;
      const title = document.createElement('div');
      title.className = 'question-title';
      title.textContent = q.q;
      div.appendChild(title);
      q.options.forEach((opt, i) => {
        const id = `q${idx}_opt${i}`;
        const label = document.createElement('label');
        label.className = 'option';
        label.htmlFor = id;
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `q${idx}`;
        radio.id = id;
        radio.value = i;
        label.appendChild(radio);
        label.appendChild(document.createTextNode(' '+opt));
        div.appendChild(label);
      });
      const fb = document.createElement('div');
      fb.className = 'small-feedback'; fb.id = `fb${idx}`; div.appendChild(fb);
      testArea.appendChild(div);
    });
  }
  renderTest();
  function checkTest(){
    let score=0, details=[];
    testQuestions.forEach((q, idx)=>{
      const sel=document.querySelector(`input[name="q${idx}"]:checked`);
      const fb=document.getElementById(`fb${idx}`);
      if(!sel){ fb.textContent="–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞–ª–º–∞“ì–∞–Ω."; fb.className='small-feedback wrong'; details.push(`–°${idx+1}: –∂–æ“õ.`); return;}
      if(Number(sel.value)===q.correct){score++;fb.textContent="–î“±—Ä—ã—Å!";fb.className='small-feedback correct';}
      else{fb.textContent="“ö–∞—Ç–µ.";fb.className='small-feedback wrong';details.push(`–°${idx+1}: “õ–∞—Ç–µ.`);}
    });
    return {score,details};
  }
  // Match
  const matchPairs=[
    {formula:"S_{“Ø—à–±} = ¬Ω a¬∑h",letter:"a",desc:"“Æ—à–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã"},
    {formula:"S_{—Ç”©—Ä—Ç–±} = a¬∑b",letter:"b",desc:"–¢—ñ–∫ —Ç”©—Ä—Ç–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã"},
    {formula:"C = 2œÄr",letter:"c",desc:"–®–µ“£–±–µ—Ä “±–∑—ã–Ω–¥—ã“ì—ã"},
    {formula:"S_{—à–µ“£–±} = œÄr¬≤",letter:"d",desc:"–®–µ“£–±–µ—Ä –∞—É–¥–∞–Ω—ã"},
    {formula:"S_{–∫–≤–∞–¥—Ä} = a¬≤",letter:"e",desc:"–ö–≤–∞–¥—Ä–∞—Ç –∞—É–¥–∞–Ω—ã"}
  ];
  const matchArea=document.getElementById('matchArea');
  function renderMatch(){
    const leftCol=document.createElement('div'),rightCol=document.createElement('div');
    matchPairs.forEach((item,idx)=>{
      const d=document.createElement('div');
      d.className='match-item';
      d.innerHTML=`<strong>${idx+1}) ${item.formula}</strong><br>–ñ–∞—É–∞–±—ã: <input maxlength="1" data-index="${idx}" />`;
      leftCol.appendChild(d);
    });
    const shuffled=[...matchPairs].sort(()=>Math.random()-.5);
    shuffled.forEach(item=>{
      const d=document.createElement('div');
      d.className='match-item';
      d.innerHTML=`<strong>${item.letter})</strong> ${item.desc}`;
      rightCol.appendChild(d);
    });
    matchArea.innerHTML='';matchArea.appendChild(leftCol);matchArea.appendChild(rightCol);
  }
  renderMatch();
  function checkMatch(){
    const inputs=matchArea.querySelectorAll('input[data-index]');
    let correct=0,total=matchPairs.length;
    inputs.forEach(inp=>{
      const idx=Number(inp.dataset.index);
      const val=(inp.value||'').trim().toLowerCase();
      if(val===matchPairs[idx].letter){correct++;inp.style.borderColor='var(--good)';}
      else inp.style.borderColor='var(--danger)';
    });
    return {correct,total};
  }

  // –ï—Å–µ–ø—Ç–µ—É / —Ñ–∏–≥—É—Ä–∞ auto
  const figType=document.getElementById('figType'),figFields=document.getElementById('figFields'),
    figCalcBtn=document.getElementById('figCalcBtn'),figCalcOut=document.getElementById('figCalcOut');
  function renderFigFields(){
    let v=figType.value;
    if(v==='tri')figFields.innerHTML='a:<input id="fa" value="6" type="number" style="width:40px"> h:<input id="fh" value="5" type="number" style="width:40px">';
    else if(v==='rect')figFields.innerHTML='a:<input id="fa" value="7" type="number" style="width:40px"> b:<input id="fb" value="3" type="number" style="width:40px">';
    else if(v==='sq')figFields.innerHTML='a:<input id="fa" value="5" type="number" style="width:40px">';
    else if(v==='circle')figFields.innerHTML='r:<input id="fr" value="4" type="number" style="width:40px">';
    figCalcOut.textContent="";
  }
  figType.onchange=renderFigFields;renderFigFields();

  // --- –æ–Ω–ª–∞–π–Ω —Ç–∞“õ—Ç–∞
  const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d'),modeEl=document.getElementById('mode'),sizeEl=document.getElementById('size'),colorEl=document.getElementById('color');
  let drawing=false,lastX=0,lastY=0,lineStart=null,history=[];
  function fitCanvas(){
    const r=canvas.getBoundingClientRect(),dpr=window.devicePixelRatio||1;
    canvas.width=Math.floor(r.width*dpr);canvas.height=Math.floor(r.height*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    if(history.length){const img=new Image();img.onload=()=>ctx.drawImage(img,0,0,r.width,r.height);img.src=history[history.length-1];}
  }
  function snapshot(){history.push(canvas.toDataURL());if(history.length>12)history.shift();}
  function getPos(e){const r=canvas.getBoundingClientRect(),x=(e.touches?e.touches[0].clientX:e.clientX)-r.left,y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;return{x,y};}
  function start(e){e.preventDefault();const{x,y}=getPos(e),mode=modeEl.value;if(mode==='line'){if(!lineStart){lineStart={x,y};}else{snapshot();ctx.save();ctx.lineCap='round';ctx.lineJoin='round';ctx.lineWidth=+sizeEl.value;ctx.strokeStyle=colorEl.value;ctx.beginPath();ctx.moveTo(lineStart.x,lineStart.y);ctx.lineTo(x,y);ctx.stroke();ctx.restore();lineStart=null;}return;}snapshot();drawing=true;lastX=x;lastY=y;}
  function move(e){if(!drawing)return;e.preventDefault();const{x,y}=getPos(e),mode=modeEl.value;ctx.save();ctx.lineCap='round';ctx.lineJoin='round';ctx.lineWidth=+sizeEl.value;if(mode==='eraser'){ctx.globalCompositeOperation='destination-out';ctx.strokeStyle='rgba(0,0,0,1)';}else{ctx.globalCompositeOperation='source-over';ctx.strokeStyle=colorEl.value;}ctx.beginPath();ctx.moveTo(lastX,lastY);ctx.lineTo(x,y);ctx.stroke();ctx.restore();lastX=x;lastY=y;}
  function end(){drawing=false;}
  document.getElementById('clearBtn').onclick=()=>{snapshot();ctx.clearRect(0,0,canvas.width,canvas.height);lineStart=null;};
  document.getElementById('undoBtn').onclick=()=>{if(history.length<2)return;history.pop();const img=new Image();img.onload=()=>{const r=canvas.getBoundingClientRect();ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,r.width,r.height);};img.src=history[history.length-1];lineStart=null;};
  canvas.addEventListener('mousedown',start);canvas.addEventListener('mousemove',move);window.addEventListener('mouseup',end);
  canvas.addEventListener('touchstart',start,{passive:false});canvas.addEventListener('touchmove',move,{passive:false});window.addEventListener('touchend',end);
  window.addEventListener('resize',fitCanvas);fitCanvas();snapshot();

  // ---- –§–∏–≥—É—Ä —Å–∞–ª—É
  function drawAutoFig(fig,val1,val2){
    fitCanvas();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // —Ñ–∏–≥—É—Ä–∞–ª–∞—Ä –∂–∞–ª–ø—ã“ì–∞ –æ—Ä—Ç–∞“õ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–º–∞—Å—à—Ç–∞–±): ~40 px = 1 –±—ñ—Ä–ª—ñ–∫
    let k = Math.min(canvas.width,canvas.height)/10;
    ctx.save();ctx.strokeStyle="#6366f1";ctx.lineWidth=3;ctx.fillStyle="#a7b5f9";
    if(fig==="tri"){
      let a=+val1||6,h=+val2||5;
      // “Æ—à–±“±—Ä—ã—à (—Å–æ–ª –∂–∞“õ —Ç”©–º–µ–Ω A, –æ“£ –∂–∞“õ —Ç”©–º–µ–Ω B, –∂–æ“ì–∞—Ä“ì—ã C)
      let pad=25;
      let A={x:pad,y:canvas.height-pad},B={x:pad+a*k,y:canvas.height-pad},C={x:pad,y:canvas.height-pad-h*k};
      ctx.beginPath();
      ctx.moveTo(A.x,A.y);ctx.lineTo(B.x,B.y);ctx.lineTo(C.x,C.y);ctx.closePath();
      ctx.fill();ctx.stroke();
      // –±–∏—ñ–∫—Ç—ñ–∫
      ctx.beginPath();
      ctx.moveTo(B.x,B.y);ctx.lineTo(C.x,C.y);ctx.strokeStyle="#f43f5e";
      ctx.setLineDash([6,2]);ctx.stroke();ctx.setLineDash([]);
      ctx.restore();
    }
    else if(fig==="rect"){
      let a=+val1||7,b=+val2||3,pad=25;
      ctx.beginPath();
      ctx.rect(pad,pad,a*k,b*k);
      ctx.fill();ctx.stroke();
      ctx.restore();
    }
    else if(fig==="sq"){
      let a=+val1||5,pad=33;
      ctx.beginPath();
      ctx.rect(pad,pad,a*k,a*k);
      ctx.fill();ctx.stroke();
      ctx.restore();
    }
    else if(fig==="circle"){
      let r=+val1||4,xc=canvas.width/2,yc=canvas.height/2;
      ctx.beginPath();
      ctx.arc(xc,yc,r*k,0,2*Math.PI);
      ctx.fill();ctx.stroke();
      ctx.restore();
    }
  }
  figCalcBtn.onclick=()=>{
    let figure=figType.value;
    let out="", a,b,r, s;
    if(figure==='tri'){
      a=+document.getElementById('fa').value;let h=+document.getElementById('fh').value;
      s=0.5*a*h;out=`S=0.5√ó${a}√ó${h}=${s}`;
      drawAutoFig("tri",a,h);
    }
    else if(figure==='rect'){
      a=+document.getElementById('fa').value;
      b=+document.getElementById('fb').value;
      s=a*b;out=`S=${a}√ó${b}=${s}`;
      drawAutoFig("rect",a,b);
    }
    else if(figure==='sq'){
      a=+document.getElementById('fa').value;s=a*a;out=`S=${a}¬≤=${s}`;
      drawAutoFig("sq",a,0);
    }
    else if(figure==='circle'){
      r=+document.getElementById('fr').value;s=(Math.PI*r*r).toFixed(2);out=`S=œÄ√ó${r}¬≤ ‚âà ${s}`;
      drawAutoFig("circle",r,0);
    }
    figCalcOut.textContent=out;
  };

  // --- —Ç–µ—Å—Ç/–º–∞—Ç—á, –Ω”ô—Ç–∏–∂–µ —Å–∞“õ—Ç–∞—É
  const checkAllBtn=document.getElementById('checkAllBtn'),scoreSummaryEl=document.getElementById('scoreSummary');
  let lastScore=null;
  checkAllBtn.onclick=()=>{
    const testRes=checkTest(),matchRes=checkMatch();
    const mainScore=testRes.score,bonus=matchRes.correct*0.2,totalScore=Math.min(10,+(mainScore+bonus).toFixed(1));
    lastScore=totalScore;
    scoreSummaryEl.textContent="–ñ–∞–ª–ø—ã –±–∞–ª–ª: "+totalScore+" / 10.";
    testResult.style.display='block'; testResult.textContent=`–¢–µ—Å—Ç: ${testRes.score}/10.`;
    matchResult.style.display='block'; matchResult.textContent=`–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É: ${matchRes.correct}/${matchRes.total}.`;
  };
  // LocalStorage –Ω”ô—Ç–∏–∂–µ
  const saveResultBtn=document.getElementById('saveResultBtn'),studentNameEl=document.getElementById('studentName'),saveMessageEl=document.getElementById('saveMessage'),resultsTableBody=document.querySelector('#resultsTable tbody'),clearResultsBtn=document.getElementById('clearResultsBtn');
  const STORAGE_KEY='mathBoard_geometry_results';
  function loadResults(){const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return[];try{const arr=JSON.parse(raw);return Array.isArray(arr)?arr:[];}catch(e){return[];}}
  function saveResults(arr){localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));}
  function renderResultsTable(){const arr=loadResults();resultsTableBody.innerHTML='';arr.forEach((row,idx)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${idx+1}</td><td>${row.name}</td><td>${row.score}</td><td>${row.time}</td><td>${row.remaining}</td>`;resultsTableBody.appendChild(tr);});}
  renderResultsTable();
  saveResultBtn.onclick=()=>{
    if(lastScore==null){saveMessageEl.textContent="–ê–ª–¥—ã–º–µ–Ω ‚Äú–¢–µ–∫—Å–µ—Ä—É‚Äù –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å—ã“£—ã–∑.";saveMessageEl.style.color='var(--danger)';return;}
    const name=studentNameEl.value.trim();if(!name){saveMessageEl.textContent="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑–¥—ñ –∂–∞–∑—ã“£—ã–∑.";saveMessageEl.style.color='var(--danger)';return;}
    const now=new Date(),timeStr=now.toLocaleString('kk-KZ',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const result={name,score:lastScore,time:timeStr,remaining:ftime(remaining)};
    const arr=loadResults();arr.push(result);saveResults(arr);renderResultsTable();
    saveMessageEl.textContent="–ù”ô—Ç–∏–∂–µ —Å–∞“õ—Ç–∞–ª–¥—ã.";saveMessageEl.style.color='var(--good)';
  };
  clearResultsBtn.onclick=()=>{if(confirm('–ë–∞—Ä–ª—ã“õ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä–¥—ñ ”©—à—ñ—Ä—É–¥—ñ “õ–∞–ª–∞–π—Å—ã–∑ –±–∞?')){saveResults([]);renderResultsTable();saveMessageEl.textContent='–ë–∞—Ä–ª—ã“õ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä ”©—à—ñ—Ä—ñ–ª–¥—ñ.';saveMessageEl.style.color='var(--muted)';}};
</script>
</body>
</html>
